---
title: "Utilize Worldwide Bureaucracy Indicators to implement public policies"
subtitle: "INFO 526 - Summer 2024 - Final Project"
author: 
  - name: "Mohammad Rahat Helal"
    affiliations:
      - name: "School of Information, University of Arizona"
description: "This project aims to discover efficient public policies implementation through the analysis of bureaucracy indicators around the world"
format:
   html:
    code-tools: true
    code-overflow: wrap
    embed-resources: true
bibliography: references.bib
editor: visual
execute:
  warning: false
  echo: false
---

## Abstract

The available data on public sector employment globally suggests that it forms one of the significant job generators and seems necessary for any economy. Referring to @baig2021introducing, the World Bank developed a dataset called "Worldwide Bureaucracy Indicators," or WWBI, which consists of information on public and private sector income, employment, and employee wages further divided into sub-categories. Although the original dataset consists of more than 150 indicators of bureaucracy, the subset of that data is available for us to delve deeper into a few critical indicators for evaluating economic growth and policymaking. The dataset used for this project has nearly 20 such variables for all participating countries that help us answer a few questions. One of the starting points for this project is understanding the year-on-year trend of public sector employment across geographies and a possible comparison between them.

Furthermore, the focus is shifted to a single country, and the rise or fall of employment trends through these years is assessed. Based on the outcome, the following research will establish the reasons behind such a scenario and help policymakers accordingly. The next topic to be discussed is the relationship between the efficiency of public administration and income levels in various countries. The exercise analyzes underlying data and reviews whether efficiency relates to income groupings.

### Question 1:

Compare the different regions globally, research how has public sector employment changed over time? Pick up one country in a region and research if there are underlying factors for such changes?

### Question 2:

In context of public administration in different geographies, what is the relationship between income group and public administration efficiency?

### Visualization - 1

```{r}
#| label: load-packages
#| message: false
#| output: false
#| echo: false

if(!require(pacman))
  install.packages("pacman")

pacman::p_load(
  here,
  tidyverse,
  ggrepel,
  devtools,
  tidytuesdayR,
  dplyr,
  readr,
  janitor,
  ggplot2,
  showtext,
  gridExtra,
  sf,
  rnaturalearth,
  rnaturalearthdata
  )

options(width = 65)

knitr::opts_chunk$set(
  fig.asp = 0.618,
  fig.align = "center",
  fig.retina = 1,
  fig.showtext = T
)

```

```{r}
#| label: Visualization-1
#| message: false
#| echo: false
#| output: false

# Suppress all output during the data loading
invisible(capture.output({
  tuesdata <- tidytuesdayR::tt_load('2024-04-30')
}))

# create separate dataframes for each parts - data, series, and country
wwbi_data <- tuesdata$wwbi_data
wwbi_series <- tuesdata$wwbi_series
wwbi_country <- tuesdata$wwbi_country

# glimpse(wwbi_data)
# glimpse(wwbi_series)
# glimpse(wwbi_country)

# replicate base data into three dataframes to analyze question 1
country_df <- wwbi_country 
data_df <- wwbi_data 
series_df <- wwbi_series 

# merge the three data frames on indicator code and country code 
merged_df <- merge(data_df, series_df, by = "indicator_code")
merged_df <- merge(merged_df, country_df, by = "country_code")

# Public sector employment
ps_empl_indicator <- merged_df %>%
  filter(str_detect(str_to_lower(indicator_name), "public sector employment"))

distinct_ps_empl_ind <- ps_empl_indicator %>%
  distinct(indicator_code, indicator_name)

# print(distinct_ps_empl_ind)

grouped_ps_empl_ind <- ps_empl_indicator %>%
  group_by(indicator_code, indicator_name) %>%
  summarise(record_count = n(), .groups = "drop") %>% 
  arrange(desc(record_count))

# print(grouped_ps_empl_ind)

# Filter for the public sector employment indicator (share of total employment)
employment_data_tot <- merged_df %>%
  filter(indicator_code == "BI.EMP.TOTL.PB.ZS")

# Filter for the public sector employment indicator  (share of total and paid employment)  
empl_data_tot_paid <- merged_df %>%
  filter(indicator_code %in% c("BI.EMP.TOTL.PB.ZS", "BI.EMP.PWRK.PB.ZS", "BI.EMP.FRML.PB.ZS", "BI.EMP.TOTL.PB.UR.ZS", "BI.EMP.TOTL.PB.RU.ZS"))

# print(empl_data_tot_paid)

# Aggregate data by year and region - for All geogrpahies
aggregated_data <- employment_data_tot %>%
  group_by(year, region) %>%
  summarise(mean_value = mean(value, na.rm = TRUE), .groups = "drop")

# # Aggregate data by year, region, and indicator_code - for NA
# aggregated_data_na <- empl_data_tot_paid %>%
#   group_by(year, region, indicator_code) %>%
#   summarise(mean_value = mean(value, na.rm = TRUE), .groups = "drop")

# aggregated_data_na <- aggregated_data_na %>%
#   filter(region == "North America")

# print(aggregated_data_na)

# # Create plot_a with decreased width and separate colors for each indicator_code
# plot_a <- ggplot(aggregated_data_na, aes(x = year, y = mean_value, color = indicator_code, linetype = indicator_code)) +
#   geom_line() +
#   geom_point() +
#   facet_wrap(~ region) +
#   labs(title = "Public Sector Employment as a Share of\nTotal Employment Over Time by Region\nNorth America",
#        x = "Year",
#        y = "Public Sector Employment Share (%)",
#        color = "Indicator Code",
#        linetype = "Indicator Code") +
#   theme_minimal() +
#   theme(text = element_text(size = 8),
#         axis.text.y = element_text(size = 9),
#         legend.position = "bottom",
#         legend.title = element_blank(),
#         legend.text = element_text(size = 8),
#         legend.spacing.y = unit(0.5, 'lines'),
#         plot.margin = margin(10, 10, 10, 10)) +  # Add margin around plot_a
#   guides(color = guide_legend(nrow = 3), linetype = guide_legend(nrow = 3))
# 
# print(plot_a)

# Create plot_b with increased width
plot_b <- ggplot(aggregated_data, aes(x = year, y = mean_value, color = region)) +
  geom_line() +
  scale_x_continuous(breaks = unique(aggregated_data$year)) +
  geom_point() +
  labs(title = "Public Sector Employment as a Share of Total Employment Over Time by Region All Geographies",
       x = "Year",
       y = "Public Sector Employment Share (%)",
       color = "Region") +
  theme_minimal() +
  theme(text = element_text(size = 8),
        axis.text.y = element_text(size = 9),
        legend.position = "bottom",
        plot.margin = margin(10, 10, 10, 10),
        legend.key.size = unit(0.7, "lines"),
        legend.spacing.x = unit(0.5, "cm")
        )

print(plot_b)

# Display the plots side by side with adjusted widths
# grid.arrange(plot_b, plot_a, ncol = 2, widths = c(0.55, 0.45))

```


```{r}
#| label: Question-1a
#| message: false
#| echo: false
#| output: false

# Load necessary libraries
library(ggplot2)
library(dplyr)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(viridis)

# Replicate base data into three dataframes to analyze question 1
country_df <- wwbi_country 
data_df <- wwbi_data 
series_df <- wwbi_series 

# Merge the three data frames on indicator code and country code 
merged_df <- merge(data_df, series_df, by = "indicator_code")
merged_df <- merge(merged_df, country_df, by = "country_code")

# Filter for the public sector employment indicator (share of total employment)
employment_data_tot <- merged_df %>%
  filter(indicator_code == "BI.EMP.TOTL.PB.ZS")

# Aggregate data by region to get the mean employment share
aggregated_data <- employment_data_tot %>%
  group_by(region) %>%
  summarise(mean_value = mean(value, na.rm = TRUE), .groups = "drop")

# Get world map data
world <- ne_countries(scale = "medium", returnclass = "sf")

# Join aggregated data with world map data
world_aggregated <- world %>%
  left_join(aggregated_data, by = c("region_wb" = "region"))

# Create heatmap plot with continuous color scale
plot_heatmap <- ggplot(data = world_aggregated) +
  geom_sf(aes(fill = mean_value), color = "black", size = 0.1) +
  scale_fill_viridis_c(option = "plasma", na.value = "grey50", name = "Public Sector\nEmployment Share (%)") +
  theme_minimal() +
  labs(title = "Public Sector Employment Share by Region",
       fill = "Employment Share (%)",
       caption = "Source: WWBI Data") +
  theme(
    text = element_text(size = 8),
    legend.position = "bottom",
    legend.direction = "horizontal",
    legend.key.width = unit(2, "cm"),  # Elongate the legend key width
    legend.key.height = unit(0.5, "cm"),  # Adjust the legend key height
    plot.margin = margin(10, 10, 10, 10),
    legend.title = element_text(size = 8),  # Adjust legend title size
    legend.text = element_text(size = 8)  # Adjust legend text size
  )

print(plot_heatmap)

```



```{r}
#| label: Question-1b
#| message: false
#| echo: false

# named vector for five indicators
indicator_labels <- c(
  "BI.EMP.TOTL.PB.ZS" = "Share of total employment",
  "BI.EMP.PWRK.PB.ZS" = "Share of paid employment",
  "BI.EMP.FRML.PB.ZS" = "Share of formal employment",
  "BI.EMP.TOTL.PB.UR.ZS" = "Share of total employment by urban location",
  "BI.EMP.TOTL.PB.RU.ZS" = "Share of total employment by rural location"
)

# Filter for the public sector employment indicator (share of total and paid employment)
empl_data_tot_paid <- merged_df %>%
  filter(indicator_code %in% names(indicator_labels))

# Add a new column for descriptive labels
empl_data_tot_paid <- empl_data_tot_paid %>%
  mutate(indicator_label = factor(indicator_code, levels = names(indicator_labels), labels = indicator_labels))

# Aggregate data by year, region, and indicator_label - for NA
aggregated_data_na <- empl_data_tot_paid %>%
  group_by(year, region, indicator_label) %>%
  summarise(mean_value = mean(value, na.rm = TRUE), .groups = "drop")

aggregated_data_na <- aggregated_data_na %>%
  filter(region == "North America")

# Create plot_a with decreased width and separate colors for each indicator_label
plot_na2 <- ggplot(aggregated_data_na, aes(x = year, y = mean_value, fill = indicator_label)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_x_continuous(breaks = unique(aggregated_data_na$year)) +
  labs(title = "Public Sector Employment as a Share of Total Employment\nOver Time by Region - North America",
       x = "Year",
       y = "Public Sector Employment Share (%)",
       fill = "Indicator") +
  theme_minimal() +
  theme(text = element_text(size = 8),
        axis.text.y = element_text(size = 9),
        legend.position = "bottom",
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.spacing.y = unit(0.5, 'lines'),
        plot.margin = margin(10, 10, 10, 10)) +  # Add margin around plot_a
  guides(fill = guide_legend(nrow = 3))

print(plot_na2)

```


```{r}
#| label: Question-2
#| message: false
#| echo: false

# Read the data

country_df_2 <- wwbi_country 
data_df_2 <- wwbi_data 
series_df_2 <- wwbi_series 

# country_df_2 <- country_df_2 %>%
#   clean_names() %>%
#   remove_empty("cols")

# efficiency_indicators <- series_df_2 %>%
#   filter(str_detect(str_to_lower(indicator_name), "public administration efficiency"))

# Check available indicators related to public administration or efficiency
relevant_indicators <- series_df_2 %>%
  filter(str_detect(str_to_lower(indicator_name), "administration|government|efficiency"))

# View relevant indicators
# print(relevant_indicators)

# Filter data_df for these indicators
efficiency_data <- data_df_2 %>%
  filter(indicator_code %in% relevant_indicators$indicator_code)

# Merge data_df with country_df to get income group information
merged_df_2 <- merge(efficiency_data, country_df_2, by = "country_code")

# Aggregate and visualize the data
efficiency_aggregated_2 <- merged_df_2 %>%
  group_by(income_group, year) %>%
  summarise(mean_efficiency = mean(value, na.rm = TRUE), .groups = "drop")

# Plot the data
ggplot(efficiency_aggregated_2, aes(x = year, y = mean_efficiency, color = income_group)) +
  geom_line() +
  geom_point() +
  labs(title = "Relationship Between Income Group and\nPublic Administration Efficiency Over Time",
       x = "Year",
       y = "Public Administration Efficiency",
       color = "Income Group") +
  theme_minimal()

```